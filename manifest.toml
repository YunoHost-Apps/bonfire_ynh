packaging_format = 2

id = "bonfire"
name = "Bonfire"
description.en = "Federated social networking server built on ActivityPub open protocol"
description.fr = "Serveur de réseautage social fédéré basé sur le protocole ouvert ActivityPub"

version = "1.0.0~ynh1"

maintainers = ["Lapineige"]

[upstream]
license = "AGPL-3.0-only"
website = "https://bonfirenetworks.org/"
demo = "https://campground.bonfire.cafe/"
admindoc = "https://docs.bonfirenetworks.org/"
userdoc = "https://docs.bonfirenetworks.org/"
code = "https://github.com/bonfire-networks/bonfire-app"

[integration]
yunohost = ">= 11.2.18"
helpers_version = "2.1"
multi_instance = false
architectures = "all"
ldap = false
sso = false
disk = "500M"
ram.build = "50M"
ram.runtime = "1000M"

[install]
  [install.domain]
  type = "domain"
  help.en = "The domain name to use. Bonfire will be installed at its root path (/). This can't be changed."
  help.fr = "Nom de domaine à utiliser. Bonfire sera installé à sa racine (/). Cela ne pourra pas être changé."

  [install.is_public]
    type = "boolean"
    default = true
    help.en = "Should that instance be visible to the fediverse ? It is required for federation."
    help.fr = "Cette instance doit elle être visible sur le fédiverse? C'est nécessaire pour la fédération."

  [install.init_main_permission]
    type = "group"
    default = "visitors"

  [install.language]
    ask.en = "Choose the application language"
    ask.fr = "Choisissez la langue de l'application"
    type = "select"
    choices = ["fr", "en"]
    default = "en"

  [install.media_upload_size]
    ask.en = "Choose the maximum size of the media uploaded. Can be changed later."
    ask.fr = "Choisissez la taille maximale des médias mis en ligne. Peut-être modifié ultérieurement."
    type = "select"
    choices = [
      "1MB",
      "2MB",
      "5MB",
      "10MB",
      "15MB",
      "20MB",
      "35MB",
      "50MB",
      "70MB",
      "100MB",
      "150MB"
      ]
    default = "35MB"

  [install.instance_name]
    ask.en = "Instance name (can be changed later)"
    ask.fr = "Nom de l'instance (peut être modifié ultérieurement)"
    type = "string"
    default = "Bonfire"
    help.en = "The name of your Bonfire instance that will be displayed to users"
    help.fr = "Le nom de votre instance Bonfire qui sera affiché aux utilisateurs"

  [install.invite_only]
    ask.en = "Require invitations to sign up?"
    ask.fr = "Exiger des invitations pour s'inscrire ?"
    type = "boolean"
    default = true
    help.en = "If enabled, users need an invite link to create an account. You can always invite users from your admin panel."
    help.fr = "Si activé, les utilisateurs ont besoin d'un lien d'invitation pour créer un compte. Vous pouvez toujours inviter des utilisateurs depuis votre panneau d'administration."

  [install.instance_description]
    ask.en = "Instance description (optional)"
    ask.fr = "Description de l'instance (optionnel)"
    type = "string"
    optional = true
    help.en = "A short description of your Bonfire instance"
    help.fr = "Une courte description de votre instance Bonfire"

[resources]

    [resources.system_user]
    allow_email = true

    [resources.install_dir]
    group = "www-data:r-x"

    [resources.data_dir]
    group = "www-data:r-x"

    [resources.ports]
    # Port will be automatically assigned by YunoHost

    [resources.permissions]
    main.url = "/"

    [resources.sources]

    [resources.sources.main]
    url = "https://github.com/bonfire-networks/bonfire-app/archive/refs/tags/v1.0.0.tar.gz"
    sha256 = "47e1c6a50fb5fb2809c7dd0e6bbd8f6bdaef8222bdec79e58b2e1731131a41ee"
    autoupdate.strategy = "latest_github_release"

    [resources.apt]
    # Runtime dependencies only (pre-built release includes Erlang/Elixir)
    packages = "postgresql postgresql-contrib postgresql-15-postgis-3 curl ca-certificates git imagemagick libvips-tools poppler-utils ffmpeg"

    [resources.sources.libssl]
    extract = false
    rename = "libssl1.1.deb"
    amd64.url = "http://ftp.debian.org/debian/pool/main/o/openssl/libssl1.1_1.1.1w-0+deb11u1_amd64.deb"
    amd64.sha256 = "aadf8b4b197335645b230c2839b4517aa444fd2e8f434e5438c48a18857988f7"

    [resources.database]
    type = "postgresql"
